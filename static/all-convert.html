<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal Image Converter — iLoveIMG Style</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.3/dist/heic2any.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root{
  --bg:#f8fafc; --card:#fff; --accent:#3498db; --muted:#6b7280; --border:#e5e7eb;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg); color:#0f172a; line-height:1.5;
}
.wrap{max-width:1000px;margin:36px auto;padding:18px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.logo{display:flex;gap:12px;align-items:center}
h1{font-size:20px;margin:0}
p.lead{color:var(--muted);margin-top:6px}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
.upload-box{
  border:2px dashed rgba(15,23,42,0.08);border-radius:10px;padding:24px;
  display:flex;flex-direction:column;align-items:center;gap:12px;cursor:pointer;transition:all .2s
}
.upload-box:hover{background:linear-gradient(90deg, rgba(52,152,219,0.04), rgba(0,0,0,0.01))}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:var(--accent);color:#fff}
.btn-secondary{background:#111827;color:#fff}
.grid{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:18px}
@media (max-width:920px){.grid{grid-template-columns:1fr}}
.progress {height:8px;background:#eef2f7;border-radius:8px;overflow:hidden;margin:10px 0}
.progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#f39c12);transition:width .25s}
.preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;margin-top:12px}
.preview-item{background:#fafafa;padding:10px;border-radius:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.04); word-wrap: break-word;}
.preview-item img{width:100%;height:90px;object-fit:cover;border-radius:8px}
.preview-item div{overflow-wrap: break-word; word-break: break-word;}
.select-row{display:flex;gap:10px;align-items:center;margin-top:8px; flex-wrap: wrap;}
select, input[type="file"]{font-size:14px}
.muted{color:var(--muted)}
footer{text-align:center;margin-top:20px;color:var(--muted);font-size:13px}
.status{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="logo">
      <i class="fa fa-image" style="font-size:28px;color:var(--accent)"></i>
      <div>
        <h1>Universal Image Converter</h1>
        <p class="lead">Convert HEIC/WEBP/PNG/JPG/GIF → JPG / PNG / WEBP</p>
      </div>
    </div>
    <a class="btn btn-secondary" href="index.html"><i class="fa fa-arrow-left"></i> Back</a>
  </div>

  <div class="card">
    <div class="upload-box" id="uploadBox">
      <i class="fa fa-cloud-arrow-up" style="font-size:34px;color:var(--accent)"></i>
      <h3>Drag & drop or select images</h3>
      <p class="muted">Supported: HEIC, HEIF, WEBP, PNG, JPG, JPEG, GIF — Max 25MB each</p>

      <div class="select-row">
        <button id="selectBtn" class="btn btn-primary"><i class="fa fa-folder-open"></i> Select Files</button>
        <input id="fileInput" type="file" accept=".heic,.heif,.webp,.png,.jpg,.jpeg,.gif,image/*" multiple style="display:none">
        <label for="outFormat" class="muted" style="margin-left:8px">Output:</label>
        <select id="outFormat" style="padding:8px;border-radius:6px;border:1px solid var(--border)">
          <option value="image/jpeg">JPG</option>
          <option value="image/png">PNG</option>
          <option value="image/webp">WEBP</option>
        </select>
      </div>

      <div class="status muted" id="note">Note: animated GIFs convert only first frame.</div>
    </div>

    <div class="grid">
      <div>
        <div class="card">
          <h3>Original / Selected</h3>
          <div class="progress"><i id="bar"></i></div>
          <div id="inputPreview" class="preview-grid"></div>
        </div>
      </div>

      <aside class="card">
        <h3>Converted Outputs</h3>
        <div id="outputPreview" class="preview-grid"></div>
        <div class="controls" style="margin-top:12px;">
          <button id="convertBtn" class="btn btn-primary" style="width:100%;"><i class="fa fa-sync"></i> Convert All</button>
          <button id="downloadAllBtn" class="btn btn-primary" style="width:100%;margin-top:8px;display:none;"><i class="fa fa-download"></i> Download All (ZIP)</button>
          <button id="clearBtn" class="btn btn-secondary" style="width:100%;margin-top:8px;"><i class="fa fa-trash"></i> Clear</button>
        </div>
        <div class="status" id="progressText"></div>
      </aside>
    </div>
  </div>

  <footer>&copy; 2025 iLoveIMG-style — Universal Converter (client-side)</footer>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const selectBtn = document.getElementById('selectBtn');
const uploadBox = document.getElementById('uploadBox');
const inputPreview = document.getElementById('inputPreview');
const outputPreview = document.getElementById('outputPreview');
const convertBtn = document.getElementById('convertBtn');
const clearBtn = document.getElementById('clearBtn');
const downloadAllBtn = document.getElementById('downloadAllBtn');
const bar = document.getElementById('bar');
const progressText = document.getElementById('progressText');
const outFormat = document.getElementById('outFormat');

let files = [];
let convertedFiles = [];

selectBtn.onclick = () => fileInput.click();
uploadBox.addEventListener('dragover', e=>{e.preventDefault(); uploadBox.classList.add('highlight');});
uploadBox.addEventListener('dragleave', ()=>uploadBox.classList.remove('highlight'));
uploadBox.addEventListener('drop', e=>{e.preventDefault(); uploadBox.classList.remove('highlight'); handleFiles(e.dataTransfer.files);});
fileInput.onchange = e=>handleFiles(e.target.files);

function handleFiles(selectedFiles){
  files = Array.from(selectedFiles).filter(f=>f.size<=25*1024*1024);
  if(!files.length){inputPreview.innerHTML='<div class="muted">No valid files selected (max 25MB each).</div>'; return;}
  inputPreview.innerHTML=''; outputPreview.innerHTML=''; convertedFiles=[]; downloadAllBtn.style.display='none';
  files.forEach(f=>{
    const item=document.createElement('div'); item.className='preview-item';
    const img=document.createElement('img'); img.src=URL.createObjectURL(f); img.alt=f.name;
    const name=document.createElement('div'); name.style.fontSize='12px'; name.style.marginTop='8px'; name.textContent=f.name;
    item.appendChild(img); item.appendChild(name); inputPreview.appendChild(item);
  });
  progressText.textContent=`${files.length} file(s) ready — choose output format and click Convert All.`;
  bar.style.width='0%';
}

convertBtn.onclick = async ()=>{
  if(!files.length) return alert('Select files first!');
  convertBtn.disabled=true; clearBtn.disabled=true; outputPreview.innerHTML=''; convertedFiles=[];
  progressText.textContent='Starting conversion...'; bar.style.width='4%';
  const targetType = outFormat.value;

  for(let i=0;i<files.length;i++){
    const f = files[i];
    try{
      progressText.textContent=`Converting ${i+1}/${files.length} — ${f.name}`;
      bar.style.width=`${Math.round((i/files.length)*100)}%`;

      let baseBlob;
      const lower = f.name.toLowerCase();
      if(/\.(heic|heif)$/i.test(lower)){
        baseBlob = await heic2any({ blob: f, toType:'image/jpeg', quality:0.95 });
      } else { baseBlob = f; }

      const dataURL = await blobToDataURL(baseBlob);
      const img = await loadImage(dataURL);
      const outBlob = await imageToBlob(img,targetType,0.92);
      const outExt = mimeToExt(targetType);
      const outURL = URL.createObjectURL(outBlob);

      const item=document.createElement('div'); item.className='preview-item';
      const imgEl=document.createElement('img'); imgEl.src=outURL; imgEl.alt=f.name;
      const name=document.createElement('div'); name.style.fontSize='12px'; name.style.marginTop='8px';
      name.textContent=f.name.replace(/\.[^.]+$/,'') + '.' + outExt;

      const btn=document.createElement('button'); btn.className='btn btn-primary';
      btn.style.marginTop='8px'; btn.style.fontSize='13px'; btn.style.padding='6px 10px';
      btn.innerHTML='<i class="fa fa-download"></i> Download';
      btn.onclick=()=>downloadBlob(outBlob,name.textContent);

      item.appendChild(imgEl); item.appendChild(name); item.appendChild(btn);
      outputPreview.appendChild(item);

      convertedFiles.push({blob:outBlob, filename:name.textContent});
      bar.style.width=`${Math.round(((i+1)/files.length)*100)}%`;
    } catch(err){
      console.error(err);
      const item=document.createElement('div'); item.className='preview-item';
      item.innerHTML=`<div style="color:#b91c1c;font-size:13px">Failed: ${f.name}</div>`;
      outputPreview.appendChild(item);
    }
  }

  if(convertedFiles.length) downloadAllBtn.style.display='block';
  progressText.textContent=`Finished — ${convertedFiles.length} of ${files.length} converted.`;
  convertBtn.disabled=false; clearBtn.disabled=false;
  setTimeout(()=>bar.style.width='0%',900);
};

downloadAllBtn.onclick = async ()=>{
  const zip = new JSZip();
  convertedFiles.forEach(f=>zip.file(f.filename,f.blob));
  const content = await zip.generateAsync({type:"blob"});
  downloadBlob(content,"converted_images.zip");
};

clearBtn.onclick = ()=>{
  files=[]; convertedFiles=[]; inputPreview.innerHTML=''; outputPreview.innerHTML=''; progressText.textContent='';
  bar.style.width='0%'; fileInput.value=''; downloadAllBtn.style.display='none';
};

// Utility
function blobToDataURL(blob){return new Promise((res,rej)=>{const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(blob);});}
function loadImage(src){return new Promise((res,rej)=>{const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=src;});}
function imageToBlob(img,mime='image/jpeg',q=0.92){return new Promise(res=>{const canvas=document.createElement('canvas');canvas.width=img.naturalWidth||img.width;canvas.height=img.naturalHeight||img.height;const ctx=canvas.getContext('2d'); if(mime==='image/jpeg'){ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);} ctx.drawImage(img,0,0); canvas.toBlob(b=>res(b),mime,q);});}
function mimeToExt(mime){if(mime==='image/png') return 'png'; if(mime==='image/webp') return 'webp'; return 'jpg';}
function downloadBlob(blob,filename){const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); setTimeout(()=>URL.revokeObjectURL(a.href),2000);}
</script>
</body>
</html>
